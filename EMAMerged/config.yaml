# === EMAMerged/config.yaml ===

# ──────────────────────────────────────────────────────────────────────────────
# INTERVALS / PERIODS (reference-style; live loop auto-normalizes to timeframe)
# ──────────────────────────────────────────────────────────────────────────────
intervals: ["15m"]            # reference key; normalized to timeframe "15Min"
periods:
  "15m": "10d"                # reference key; normalized to history_days=10

# Backward-compat (kept; will be overridden by intervals/periods above if set)
timeframe: "15Min"
history_days: 30
min_minutes_after_open_for_entry: 0

# ──────────────────────────────────────────────────────────────────────────────
# SESSION / DATA
# ──────────────────────────────────────────────────────────────────────────────
timezone: "US/Eastern"
rth_only: true
rth_start: "09:30"
rth_end:   "15:55"

# Entry Windows (Eastern Time) - Block Lunch (12:00-13:00)
entry_windows:
  - start: "09:45"  # Avoid first 15m volatility
    end: "11:59"
  - start: "13:00"  # Post-lunch
    end: "15:45"    # Stop before close

bar_limit: 10000
feed: "iex"

run:
  force_run: 0
  dry_run: 0

# ──────────────────────────────────────────────────────────────────────────────
# INDICATORS (reference-friendly names; auto-mapped)
# ──────────────────────────────────────────────────────────────────────────────
ema_fast: 9
ema_slow: 21
rsi_length: 14        # mapped to filters.rsi_period
atr_length: 14        # mapped to atr_period for ATR calc
vol_sma_length: 10
adx_period: 14        # NEW: DI/ADX calculation length

# ──────────────────────────────────────────────────────────────────────────────
# RISK CONTROLS
# ──────────────────────────────────────────────────────────────────────────────
flatten_minutes_before_close: 5     # flatten before close
entry_cutoff_min: 20                # block NEW entries within last N minutes

# POSITION / SIZING
allow_shorts: false
qty: 1
max_shares_per_trade: 1             # reference knob (enforced in live loop)
max_open_trades_per_ticker: 1       # reference knob (enforced in live loop)
max_notional_per_trade: 2000        # hard cap per order

# ──────────────────────────────────────────────────────────────────────────────
# BRACKET ORDERS (aligned to reference: ATR stop + R-multiple target)
# ──────────────────────────────────────────────────────────────────────────────
brackets:
  enabled: true
  atr_mult_sl: 1.5          # stop distance = 1.5 × ATR   (ref: atr_mult)
  take_profit_r: 3.0        # TP at +3.0R                  (ref: use_rr_target + rr_target)

# Optional: breakeven bump at partial R
breakeven:
  enabled: true
  trigger_r: 0.8            # at +0.8R, move stop to BE + ticks (increased from 0.5R)
  bump_ticks: 2
  tick_size: 0.01

# ──────────────────────────────────────────────────────────────────────────────
# FILTERS / GATES (now fully config-driven)
# ──────────────────────────────────────────────────────────────────────────────
filters:
  adx_threshold: 20        # trend strength gate (raise to 25.0 for stricter)
  rsi_period: 14             # comes from rsi_length above if omitted
  rsi_min: 30                # reference rsi_long_min (relaxed from 48)
  rsi_max: 85                # reference rsi_long_max
  min_rvol: 1.2              # require volume > 1.2x average
  slope_threshold_pct: 0.00040  # require EMA_fast slope ≥ +0.04% per bar
  dollar_vol_window: 20
  dollar_vol_min_periods: 7
  require_fast_above_slow: true
  require_di_trend: true     # NEW: for longs, require +DI > -DI
  require_cross: true        # NEW: only enter on a fresh bullish EMA cross

  # Optional extras (leave commented if not needed):
  # min_price: 5.0
  # min_dollar_vol: 5000000
  # dollar_vol_window: 20
  # mtf_bias:
  #   enabled: false

# ──────────────────────────────────────────────────────────────────────────────
# MANAGED EXITS
# ──────────────────────────────────────────────────────────────────────────────
exits:
  reverse_cross:
    enabled: true            # NEW: close long on bearish EMA cross

# ──────────────────────────────────────────────────────────────────────────────
# OUTPUT
# ──────────────────────────────────────────────────────────────────────────────
results_dir: "results"

# ──────────────────────────────────────────────────────────────────────────────
# BROKER (kept as-is)
# ──────────────────────────────────────────────────────────────────────────────
broker:
  base_url: "https://paper-api.alpaca.markets"
  key: ""     # leave blank (Secrets used instead)
  secret: ""  # leave blank (Secrets used instead)

# Tickers file still used by market_loop unless SYMBOLS override
